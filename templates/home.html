{% load static %}
<!doctype html>
<html lang="tr" class="theme-aurora">
<head>
<meta charset="utf-8" />
<meta name="viewport" content="width=device-width, initial-scale=1" />
<title>Andrea v1 — AI Asistan</title>

<link rel="icon" href="{% static 'favicon.ico' %}" sizes="any">
<link rel="icon" href="{% static 'icons/favicon-32.png' %}" type="image/png" sizes="32x32">
<link rel="icon" href="{% static 'icons/favicon-16.png' %}" type="image/png" sizes="16x16">

<link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
<link href="https://fonts.googleapis.com/css2?family=Inter:wght@400;500;600;700;800&display=swap" rel="stylesheet">

<style>
/* ------------------ TEMEL DEĞİŞKENLER ------------------ */
:root {
  /* Aurora Theme (Deep Purple + Aqua) */
  --bg: #0a0b0f;
  --panel: #0f1115;
  --sidebar: #0d0e12;
  --text: #e5e7eb;
  --muted: #9aa0a6;
  --accent-1: #7C3AED;
  --accent-2: #22D3EE;
  --ring: #A78BFA;
  --chip: #1a1b23;
  --icon: #b7bdc9;
  --green: #22c55e;
  --divider: #1b1e22;
  --input-bg: #0f1114;
  --input-bd: #2a2f35;
  --hover: #15181c;
  --focus: #A78BFA;
  --gradient-bg: radial-gradient(ellipse at top, rgba(124, 58, 237, 0.1) 0%, transparent 50%),
                 radial-gradient(ellipse at bottom, rgba(34, 211, 238, 0.08) 0%, transparent 50%);
}

/* Neon Theme (Pink/Ink + Cyan) */
.theme-neon {
  --bg: #0a0b0f;
  --panel: #0f1115;
  --sidebar: #0d0e12;
  --text: #e5e7eb;
  --muted: #9aa0a6;
  --accent-1: #FF2D95;
  --accent-2: #00EAFF;
  --ring: #FF77C6;
  --chip: #1a1b23;
  --icon: #b7bdc9;
  --green: #22c55e;
  --divider: #1b1e22;
  --input-bg: #0f1114;
  --input-bd: #2a2f35;
  --hover: #15181c;
  --focus: #FF77C6;
  --gradient-bg: radial-gradient(ellipse at top, rgba(255, 45, 149, 0.1) 0%, transparent 50%),
                 radial-gradient(ellipse at bottom, rgba(0, 234, 255, 0.08) 0%, transparent 50%);
}
* { box-sizing: border-box }
html, body {
  height: 100%; 
  margin: 0; 
  background: var(--bg);
  background-position: center center;
  background-size: cover;
  background-repeat: no-repeat;
  color: var(--text);
  font: 400 14px/1.45 "Inter", system-ui, -apple-system, "Segoe UI", Roboto, Helvetica, Arial;
  position: relative;
}

body::before {
  content: '';
  position: fixed;
  top: 0;
  left: 0;
  right: 0;
  bottom: 0;
  background: var(--gradient-bg);
  pointer-events: none;
  z-index: -1;
}

button { font: inherit; color: inherit; background: none; border: none; padding: 0; cursor: pointer }
a { color: #cfd3da; text-decoration: none }
.visually-hidden { position: absolute!important; width: 1px; height: 1px; padding: 0; margin: -1px; overflow: hidden; clip: rect(0 0 0 0); white-space: nowrap; border: 0 }

/* ------------------ YERLEŞİM ------------------ */
.app{display:grid; grid-template-columns:260px 1fr; height:100%; overflow:hidden}

/* ------------------ SİDEBAR ------------------ */
.sidebar {
  background: var(--sidebar); 
  padding: 12px 12px 8px; 
  display: flex; 
  flex-direction: column; 
  gap: 10px;
  border-right: 1px solid var(--divider);
  position: relative;
}

.sidebar::before {
  content: '';
  position: absolute;
  top: 0;
  left: 0;
  right: 0;
  bottom: 0;
  background: linear-gradient(135deg, rgba(124, 58, 237, 0.03) 0%, rgba(34, 211, 238, 0.02) 100%);
  pointer-events: none;
}

.theme-neon .sidebar::before {
  background: linear-gradient(135deg, rgba(255, 45, 149, 0.03) 0%, rgba(0, 234, 255, 0.02) 100%);
}

.top-strip { 
  display: flex; 
  align-items: center; 
  gap: 10px; 
  height: 32px; 
  padding: 4px 6px;
  position: relative;
  z-index: 1;
}

.theme-toggle {
  width: 24px;
  height: 24px;
  border-radius: 6px;
  background: var(--chip);
  border: 1px solid var(--divider);
  display: grid;
  place-items: center;
  color: var(--icon);
  transition: all 0.2s ease;
  cursor: pointer;
}

.theme-toggle:hover {
  background: var(--hover);
  color: var(--accent-1);
  border-color: var(--accent-1);
}

.theme-toggle:focus-visible {
  outline: 2px solid var(--ring);
  outline-offset: 2px;
}

.brand { 
  margin-left: 6px; 
  color: #cfd3da; 
  font-weight: 600; 
  letter-spacing: .2px; 
  font-size: 14px;
  position: relative;
  z-index: 1;
}

.brand small { opacity: .7; font-weight: 500 }

/* "Yeni sohbet" düğmesi */
.btn-chip {
  display: flex; 
  align-items: center; 
  gap: 8px; 
  height: 36px; 
  padding: 0 10px;
  background: var(--chip); 
  border: 1px solid var(--divider); 
  border-radius: 10px; 
  color: var(--text);
  transition: all 0.2s ease;
  position: relative;
  z-index: 1;
}

.btn-chip:hover {
  background: var(--hover);
  border-color: var(--accent-1);
  box-shadow: 0 0 0 1px var(--accent-1);
}

.btn-chip:focus-visible { 
  outline: 2px solid var(--ring); 
  outline-offset: 2px 
}

.dot { 
  width: 8px; 
  height: 8px; 
  background: var(--accent-1); 
  border-radius: 2px; 
  box-shadow: 0 4px 0 var(--accent-1), 0 -4px 0 var(--accent-1); 
  transform: rotate(90deg);
  animation: pulse 2s infinite;
}

@keyframes pulse {
  0%, 100% { opacity: 1; }
  50% { opacity: 0.6; }
}

.menu { display: flex; flex-direction: column; gap: 6px; margin-top: 6px; position: relative; z-index: 1; }
.item { 
  display: flex; 
  align-items: center; 
  gap: 10px; 
  padding: 7px 8px; 
  border-radius: 8px; 
  color: #cfd3da;
  transition: all 0.2s ease;
  position: relative;
}

.item:hover { 
  background: var(--hover);
  color: var(--text);
}

.item:focus-within { 
  outline: 2px solid var(--ring); 
  outline-offset: 2px 
}

/* Sidebar arama öğesi */
.search-item {
  display: flex;
  align-items: center;
  gap: 8px;
  padding: 6px 10px;
  border-radius: 16px;
  background: var(--chip);
  border: 1px solid var(--divider);
  transition: all 0.2s ease;
  position: relative;
  overflow: hidden;
}

.search-item:focus-within {
  border-color: var(--accent-1);
  box-shadow: 0 0 0 1px var(--accent-1);
}

.search-input {
  flex: 1;
  background: transparent;
  border: none;
  color: var(--text);
  font: inherit;
  font-size: 14px;
  outline: none;
  padding: 2px 4px;
  margin: 0;
  width: 100%;
  min-width: 0;
  border-radius: 8px;
}

.search-input::placeholder {
  color: var(--muted);
  transition: color 0.2s ease;
}

.search-input:focus::placeholder {
  color: var(--accent-1);
}

/* daha güzel ikonlar */
.icon {
  width: 18px; 
  height: 18px; 
  color: var(--icon); 
  display: inline-grid; 
  place-items: center;
  transition: color 0.2s ease;
}

.item:hover .icon {
  color: var(--accent-1);
}

.icon svg { display: block }

/* bölümler */
.section-label { 
  color: var(--muted); 
  font-size: 12px; 
  text-transform: uppercase; 
  letter-spacing: .08em; 
  margin: 10px 8px 2px;
  position: relative;
  z-index: 1;
}

.gpts { display: flex; flex-direction: column; gap: 2px; position: relative; z-index: 1; }
.gpt-item { 
  display: flex; 
  align-items: center; 
  gap: 10px; 
  padding: 6px 8px; 
  border-radius: 8px; 
  color: #d6d9df;
  transition: all 0.2s ease;
}

.gpt-item:hover {
  background: var(--hover);
  color: var(--text);
}

.model-item {
  cursor: default;
  opacity: 0.7;
}

.model-item:hover {
  background: transparent;
  color: #d6d9df;
}

/* Andrea AI button styling */
#andreaAIButton {
  cursor: pointer;
  opacity: 1;
  background: none;
  border: none;
  padding: 6px 8px;
  width: 100%;
  text-align: left;
}

#andreaAIButton:hover {
  background: var(--hover);
  color: var(--text);
}

.gpt-avatar { 
  width: 20px; 
  height: 20px; 
  border-radius: 50%; 
  background: var(--chip); 
  border: 1px solid var(--divider); 
  position: relative;
  transition: all 0.2s ease;
}

.gpt-item:hover .gpt-avatar {
  border-color: var(--accent-1);
  box-shadow: 0 0 0 1px var(--accent-1);
}

.gpt-item-wrapper {
  display: flex;
  align-items: center;
  position: relative;
}

.gpt-item-wrapper:hover .delete-btn {
  opacity: 1;
}

.gpt-title {
  flex: 1;
  min-width: 0;
  overflow: hidden;
  text-overflow: ellipsis;
  white-space: nowrap;
  max-width: 120px; /* 15 karakter için yaklaşık genişlik */
}

.delete-btn {
  width: 20px;
  height: 20px;
  border-radius: 4px;
  background: transparent;
  border: none;
  color: var(--muted);
  display: flex;
  align-items: center;
  justify-content: center;
  cursor: pointer;
  transition: all 0.2s ease;
  opacity: 0;
  margin-left: 4px;
  flex-shrink: 0;
}

.delete-btn:hover {
  background: rgba(239, 68, 68, 0.1);
  color: #ef4444;
  border-color: #ef4444;
}

.gpt-avatar::after { 
  content: ""; 
  position: absolute; 
  right: -1px; 
  bottom: -1px; 
  width: 7px; 
  height: 7px; 
  border-radius: 50%; 
  background: var(--green); 
  border: 2px solid var(--sidebar);
}

.spacer { flex: 1 }
.new-project { 
  display: flex; 
  align-items: center; 
  gap: 10px; 
  padding: 7px 8px; 
  border-radius: 8px; 
  color: #cfd3da; 
  border: 1px dashed var(--divider);
  transition: all 0.2s ease;
  position: relative;
  z-index: 1;
}

.new-project:hover {
  border-color: var(--accent-1);
  color: var(--accent-1);
  background: rgba(124, 58, 237, 0.05);
}

.theme-neon .new-project:hover {
  background: rgba(255, 45, 149, 0.05);
}

.user { 
  display: flex; 
  align-items: center; 
  gap: 10px; 
  color: #9fb0c8; 
  padding: 10px 8px; 
  border-top: 1px solid var(--divider);
  position: relative;
  z-index: 1;
}

.user .avatar { 
  width: 26px; 
  height: 26px; 
  border-radius: 50%; 
  background: var(--chip); 
  border: 1px solid var(--divider);
  transition: all 0.2s ease;
}

.user:hover .avatar {
  border-color: var(--accent-1);
  box-shadow: 0 0 0 1px var(--accent-1);
}

.logout-btn { 
  width: 20px; 
  height: 20px; 
  display: flex; 
  align-items: center; 
  justify-content: center; 
  color: var(--icon); 
  transition: all 0.2s ease; 
  border-radius: 4px; 
  margin-left: auto
}

.logout-btn:hover { 
  background: var(--hover); 
  color: var(--accent-1);
}

/* ------------------ ANA ALAN ------------------ */
.main { 
  position: relative; 
  background: var(--panel);
  overflow: hidden;
}

.main::before {
  content: '';
  position: absolute;
  top: 0;
  left: 0;
  right: 0;
  bottom: 0;
  background: var(--gradient-bg);
  pointer-events: none;
  z-index: 0;
}

.topbar { 
  position: absolute; 
  top: 10px; 
  left: 16px; 
  display: flex; 
  align-items: center; 
  gap: 8px; 
  color: #cfd3da; 
  font-weight: 600;
  z-index: 1;
}

.chev { 
  width: 8px; 
  height: 8px; 
  border-right: 2px solid #cfd3da; 
  border-bottom: 2px solid #cfd3da; 
  transform: rotate(45deg); 
  margin-left: 4px; 
  opacity: .8 
}

.gear { 
  position: absolute; 
  top: 14px; 
  right: 18px; 
  width: 18px; 
  height: 18px; 
  border: 1.5px solid var(--icon); 
  border-radius: 50%;
  transition: all 0.2s ease;
  cursor: pointer;
  z-index: 1;
}

.gear:hover {
  border-color: var(--accent-1);
  color: var(--accent-1);
}

/* Merkez başlık + arama */
.center { 
  position: absolute; 
  inset: 0; 
  display: flex; 
  flex-direction: column; 
  align-items: center; 
  justify-content: center; 
  gap: 24px;
  z-index: 1;
}

.headline { 
  font-size: 28px; 
  font-weight: 800; 
  color: #e7eaee; 
  letter-spacing: .01em;
  background: linear-gradient(135deg, var(--accent-1), var(--accent-2));
  -webkit-background-clip: text;
  -webkit-text-fill-color: transparent;
  background-clip: text;
  text-align: center;
  line-height: 1.2;
}

/* ARAMA ÇUBUĞU: gerçek input + tuşlar */
.searchbar {
  width: min(980px, 80%);
  min-height: 44px;
  height: auto;
  display: flex;
  align-items: flex-start;
  gap: 10px;
  background: var(--input-bg);
  border: 1px solid var(--input-bd);
  border-radius: 24px;
  padding: 6px 12px;
  color: #cfd3da;
  transition: all 0.2s ease;
  position: relative;
}

.searchbar:focus-within {
  border-color: var(--accent-1);
  box-shadow: 0 0 0 1px var(--accent-1), 0 0 20px rgba(124, 58, 237, 0.1);
}

.theme-neon .searchbar:focus-within {
  box-shadow: 0 0 0 1px var(--accent-1), 0 0 20px rgba(255, 45, 149, 0.1);
}

.pill { 
  width: 28px; 
  height: 28px; 
  border-radius: 10px; 
  background: var(--chip); 
  border: 1px solid var(--divider); 
  display: grid; 
  place-items: center;
  transition: all 0.2s ease;
}

.btn-icon { 
  width: 28px; 
  height: 28px; 
  border-radius: 8px; 
  display: grid; 
  place-items: center; 
  color: var(--icon);
  transition: all 0.2s ease;
  align-self: center;
}

.btn-icon:hover { 
  background: var(--hover);
  color: var(--accent-1);
}

.btn-icon:focus-visible { 
  outline: 2px solid var(--ring); 
  outline-offset: 2px 
}

.input {
  flex: 1; 
  display: flex; 
  align-items: stretch
}

.input input,
.input textarea {
  width: 100%; 
  background: transparent; 
  border: 0; 
  color: var(--text); 
  font: inherit;
  font-size: 15px;
  padding: 0;
  margin: 0;
  line-height: 1.4;
}

/* Textarea özel: güvenilir auto-resize ve nefes alanı */
.input textarea {
  display: block;
  min-height: 20px;
  max-height: 200px;
  overflow: hidden;
  padding: 6px 0;
  resize: none;
}

.input input::placeholder,
.input textarea::placeholder { 
  color: #8a94a3;
  transition: color 0.2s ease;
}

.input input:focus,
.input textarea:focus { 
  outline: none;
}

.input input:focus::placeholder,
.input textarea:focus::placeholder {
  color: var(--muted);
}

/* Odak görünürlüğü genel */
:focus-visible { 
  outline: 2px solid var(--ring); 
  outline-offset: 2px 
}

/* RESPONSIVE */
@media (max-width: 920px) {
  .app { grid-template-columns: 220px 1fr }
  .headline { font-size: 24px }
  .searchbar { width: min(760px, 86%) }
}

@media (max-width: 768px) {
  .app { grid-template-columns: 1fr }
  .sidebar { 
    position: fixed; 
    left: -260px; 
    top: 0; 
    height: 100%; 
    z-index: 1000;
    transition: left 0.3s ease;
  }
  .sidebar.open { left: 0; }
  .main { margin-left: 0; }
}
</style>
</head>
<body>
<div class="app">
  <!-- ------------- SOL SİDEBAR ------------- -->
  <aside class="sidebar" aria-label="Yan Menü">
    <div class="top-strip">
      <button class="theme-toggle" id="themeToggle" aria-label="Tema değiştir" title="Tema değiştir">
        <svg viewBox="0 0 24 24" width="16" height="16" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round">
          <circle cx="12" cy="12" r="5"></circle>
          <path d="M12 1v2M12 21v2M4.22 4.22l1.42 1.42M18.36 18.36l1.42 1.42M1 12h2M21 12h2M4.22 19.78l1.42-1.42M18.36 5.64l1.42-1.42"></path>
        </svg>
      </button>
      <div class="brand">Andrea <small>v1</small></div>
    </div>

    <a class="new-project" href="#" aria-label="Yeni sohbet başlat">
      <span class="icon" aria-hidden="true">
        <!-- artı -->
        <svg viewBox="0 0 24 24" width="18" height="18" fill="none" stroke="currentColor" stroke-width="1.8" stroke-linecap="round"><path d="M12 5v14M5 12h14"/></svg>
      </span>
      Yeni sohbet
    </a>

    <nav class="menu" aria-label="Genel">
      <div class="search-item">
        <span class="icon" aria-hidden="true">
          <!-- büyüteç -->
          <svg viewBox="0 0 24 24" width="18" height="18" fill="none" stroke="currentColor" stroke-width="1.8" stroke-linecap="round" stroke-linejoin="round">
            <circle cx="11" cy="11" r="7"></circle><path d="M21 21l-3.5-3.5"></path>
          </svg>
        </span>
        <input type="text" placeholder="Sohbetlerde ara..." class="search-input" aria-label="Sohbetlerde ara">
      </div>
    </nav>

    <div class="section-label">Modeller</div>
    <div class="gpts">
      <button class="gpt-item" id="mondayBtn" type="button">
        <span class="gpt-avatar" aria-hidden="true"></span>
        Monday
      </button>
    </div>

    <div class="section-label">Sohbetlerim</div>
    <div class="gpts" id="chatList">
      {% for c in chats %}
        <div class="gpt-item-wrapper">
          <a class="gpt-item" href="{% url 'chat:detail' c.id %}">
            <span class="gpt-avatar"></span>
            <span class="gpt-title">{{ c.title }}</span>
          </a>
          <button class="delete-btn" data-chat-id="{{ c.id }}" title="Sohbeti sil">
            <svg viewBox="0 0 24 24" width="14" height="14" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round">
              <path d="M3 6h18M8 6V4a2 2 0 0 1 2-2h4a2 2 0 0 1 2 2v2M19 6v14a2 2 0 0 1-2 2H7a2 2 0 0 1-2-2V6M10 11v6M14 11v6"></path>
            </svg>
          </button>
        </div>
      {% empty %}
        <div class="item" style="opacity:.7">Henüz sohbet yok</div>
      {% endfor %}
    </div>

    <div class="spacer"></div>

    <div class="user" role="contentinfo">
      <div class="avatar" aria-hidden="true"></div>
      <div>
        <div style="font-weight:600;color:#cfd3da;">{{ user.username|default:"Misafir Kullanıcı" }}</div>
      </div>
      <a href="{% url 'logout' %}" class="logout-btn" title="Çıkış yap">
        <svg viewBox="0 0 24 24" width="16" height="16" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round">
          <path d="M9 21H5a2 2 0 0 1-2-2V5a2 2 0 0 1 2-2h4"></path>
          <polyline points="16,17 21,12 16,7"></polyline>
          <line x1="21" y1="12" x2="9" y2="12"></line>
        </svg>
      </a>
    </div>
  </aside>

  <!-- ------------- ANA ALAN ------------- -->
  <main class="main" aria-label="Ana içerik">
    <div class="topbar">
      <span style="opacity:.9">Andrea v1</span>
    </div>

    <section class="center">
      <h1 class="headline">Bugün ne yapmak istiyorsun?</h1>

      <!-- Gerçek arama çubuğu -->
      <form class="searchbar" role="search" aria-label="Hızlı arama"
            method="post" action="{% url 'chat:start' %}">
        {% csrf_token %}
        <input type="hidden" name="persona" id="personaField" value="">
        <label class="input" for="promptField">
          <span class="visually-hidden">Soru gir</span>
          <textarea id="promptField" name="prompt" placeholder="Ne yapmak istiyorsun?" aria-label="Ne yapmak istiyorsun?" required rows="1"></textarea>
        </label>

        <!-- mikrofon -->
        <button class="btn-icon" type="button" aria-label="Mikrofon">
          <svg viewBox="0 0 24 24" width="16" height="16" fill="none" stroke="currentColor" stroke-width="1.8" stroke-linecap="round" stroke-linejoin="round">
            <rect x="9" y="3" width="6" height="11" rx="3"></rect>
            <path d="M5 10v1a7 7 0 0 0 14 0v-1"></path>
            <path d="M12 19v3"></path>
          </svg>
        </button>

        <!-- dalga/ses -->
        <button class="btn-icon" type="button" aria-label="Sesle yaz">
          <svg viewBox="0 0 24 24" width="18" height="18" fill="none" stroke="currentColor" stroke-width="1.8" stroke-linecap="round" stroke-linejoin="round">
            <path d="M3 12c2-4 4-4 6 0s4 4 6 0 4-4 6 0"></path>
          </svg>
        </button>
      </form>
    </section>
  </main>
</div>

<script>
// Tema değiştirme
document.addEventListener('DOMContentLoaded', function() {
  const themeToggle = document.getElementById('themeToggle');
  const html = document.documentElement;
  
  // Tema durumunu localStorage'dan al
  const savedTheme = localStorage.getItem('theme') || 'aurora';
  html.className = `theme-${savedTheme}`;
  
  // Tema değiştirici
  themeToggle.addEventListener('click', function() {
    const currentTheme = html.className.includes('aurora') ? 'aurora' : 'neon';
    const newTheme = currentTheme === 'aurora' ? 'neon' : 'aurora';
    
    html.className = `theme-${newTheme}`;
    localStorage.setItem('theme', newTheme);
    
    // İkon değiştir
    const icon = this.querySelector('svg');
    if (newTheme === 'aurora') {
      icon.innerHTML = '<circle cx="12" cy="12" r="5"></circle><path d="M12 1v2M12 21v2M4.22 4.22l1.42 1.42M18.36 18.36l1.42 1.42M1 12h2M21 12h2M4.22 19.78l1.42-1.42M18.36 5.64l1.42-1.42"></path>';
    } else {
      icon.innerHTML = '<path d="M21 12.79A9 9 0 1 1 11.21 3 7 7 0 0 0 21 12.79z"></path>';
    }
  });

  // Yeni sohbet butonu
  const newTaskBtn = document.querySelector('.new-project');
  if (newTaskBtn) {
    newTaskBtn.addEventListener('click', function(e) {
      e.preventDefault();
      if (location.pathname === '{% url "home" %}') {
        // ekranda zaten yeni/boş sayfa varsa -> sadece yenile
        location.reload();
      } else {
        location.href = '{% url "home" %}';
      }
    });
  }

  // Ana arama çubuğu - güvenilir auto-resize + IME + çift submit koruması
  const searchForm = document.querySelector('.searchbar');
  const textarea = document.getElementById('promptField');

  let isComposing = false;
  let isSubmitting = false;

  function autoResize(el) {
    el.style.height = 'auto';
    el.style.height = Math.min(el.scrollHeight, 200) + 'px';
  }

  if (textarea && searchForm) {
    requestAnimationFrame(() => autoResize(textarea));

    ['input','change','paste'].forEach(evt =>
      textarea.addEventListener(evt, () => autoResize(textarea))
    );

    textarea.addEventListener('compositionstart', () => { isComposing = true; });
    textarea.addEventListener('compositionend', () => { isComposing = false; autoResize(textarea); });

    textarea.addEventListener('keydown', function(e) {
      if (e.key !== 'Enter') return;
      if (e.shiftKey) return;
      if (isComposing) { e.preventDefault(); return; }

      e.preventDefault();
      if (this.value.trim() && !isSubmitting) {
        isSubmitting = true;
        // requestSubmit tetikler ve submit event'ini çalıştırır; yoksa submit'e düşer
        if (typeof searchForm.requestSubmit === 'function') {
          searchForm.requestSubmit();
        } else {
          searchForm.submit();
        }
      }
    });

    searchForm.addEventListener('submit', function(e) {
      if (isSubmitting) return;
      if (!textarea.value.trim()) { e.preventDefault(); return; }
      isSubmitting = true;
      lockSearchbar(true);
    });
  }

  function lockSearchbar(state) {
    if (!textarea) return;
    textarea.readOnly = state; // disabled olursa değer gönderilmez; readOnly yeterli
    document
      .querySelectorAll('.searchbar .btn-icon')
      .forEach(b => { b.disabled = state; b.style.opacity = state ? .5 : 1; b.style.pointerEvents = state ? 'none' : 'auto'; });
  }

  // Sidebar arama çubuğu
  const sidebarSearchInput = document.querySelector('.search-input');
  if (sidebarSearchInput) {
    sidebarSearchInput.addEventListener('keypress', function(e) {
      if (e.key === 'Enter') {
        const query = this.value.trim();
        if (query) {
          alert(`Sohbetlerde arama: "${query}" - Bu özellik yakında eklenecek!`);
        }
      }
    });
  }

  // Mikrofon butonu
  const micBtn = document.querySelector('.btn-icon[aria-label="Mikrofon"]');
  if (micBtn) {
    micBtn.addEventListener('click', function() {
      alert('Mikrofon özelliği yakında eklenecek!');
    });
  }

  // Sesle yaz butonu
  const voiceBtn = document.querySelector('.btn-icon[aria-label="Sesle yaz"]');
  if (voiceBtn) {
    voiceBtn.addEventListener('click', function() {
      alert('Sesle yazma özelliği yakında eklenecek!');
    });
  }

  // Ayarlar butonu
  const settingsBtn = document.querySelector('.gear');
  if (settingsBtn) {
    settingsBtn.addEventListener('click', function() {
      alert('Ayarlar sayfası yakında eklenecek!');
    });
  }

  // Monday seçimi: persona alanını ayarla + başlığı değiştir
  const mondayBtn = document.getElementById('mondayBtn');
  if (mondayBtn) {
    mondayBtn.addEventListener('click', function() {
      const personaField = document.getElementById('personaField');
      if (personaField) personaField.value = 'monday';
      const h1 = document.querySelector('.headline');
      if (h1) h1.textContent = 'Monday';
      document.getElementById('promptField')?.focus();
    });
  }

  // Sohbet silme butonları
  const deleteButtons = document.querySelectorAll('.delete-btn');
  deleteButtons.forEach(btn => {
    btn.addEventListener('click', async function(e) {
      e.preventDefault();
      e.stopPropagation();
      
      const chatId = this.getAttribute('data-chat-id');
      const chatTitle = this.closest('.gpt-item-wrapper').querySelector('.gpt-title').textContent;
      
      if (confirm(`"${chatTitle}" sohbetini silmek istediğinizden emin misiniz?`)) {
        try {
          const response = await fetch(`/chat/${chatId}/delete/`, {
            method: 'POST',
            headers: {
              'X-CSRFToken': document.querySelector('[name=csrfmiddlewaretoken]').value,
              'X-Requested-With': 'XMLHttpRequest',
              'Content-Type': 'application/x-www-form-urlencoded',
            }
          });
          
          if (response.ok) {
            const data = await response.json();
            if (data.ok) {
              // Sohbet öğesini DOM'dan kaldır
              this.closest('.gpt-item-wrapper').remove();
              
              // Eğer sohbet listesi boşaldıysa "Henüz sohbet yok" mesajını göster
              const gptsContainer = this.closest('.gpts') || document.getElementById('chatList');
              const remainingChats = gptsContainer.querySelectorAll('.gpt-item-wrapper');
              if (remainingChats.length === 0) {
                gptsContainer.innerHTML = '<div class="item" style="opacity:.7">Henüz sohbet yok</div>';
              }
            } else {
              alert('Sohbet silinirken bir hata oluştu.');
            }
          } else {
            alert('Sohbet silinirken bir hata oluştu.');
          }
        } catch (error) {
          console.error('Silme hatası:', error);
          alert('Sohbet silinirken bir hata oluştu.');
        }
      }
    });
  });
});
</script>
</body>
</html>
